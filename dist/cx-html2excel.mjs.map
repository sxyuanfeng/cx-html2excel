{"version":3,"file":"cx-html2excel.mjs","mappings":";;;;;;;;;AAAA;AACA,aAAa,6BAA6B;AAC1C;AACA;AACA;;;;;;SCJA;SACA;;SAEA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;;SAEA;SACA;;SAEA;SACA;SACA;;;;;UCtBA;UACA;UACA;UACA;UACA,yCAAyC,wCAAwC;UACjF;UACA;UACA;;;;;UCPA;;;;;UCAA;UACA;UACA;UACA,uDAAuD,iBAAiB;UACxE;UACA,gDAAgD,aAAa;UAC7D;;;;;;;;;;;;;;ACNA,gBAAgB,mBAAO,CAAC,wBAAS;AACjC;AACA,4CAA4C;AAC5C,mCAAmC;AACnC,iEAAiE;AACjE;AACA,iDAAiD;AACjD,iDAAiD;AACjD,+CAA+C;AAC/C;AACA;AACA;AACA,oEAAoE;AACpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,aAAa;AACb,eAAe;AACf,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,iBAAiB;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,UAAU,iDAAiD;AAC3D,YAAY;AACZ,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA,cAAc,GAAG,QAAQ,IAAI;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,qBAAqB;AACtC;AACA;AACA;AACA;AACA,oBAAoB,sDAAsD;AAC1E;AACA,OAAO,mCAAmC;AAC1C;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA,IAAI;AACJ,iBAAiB;AACjB;AACA;AACA;AACA,mBAAmB,qBAAqB;AACxC;AACA;AACA;AACA,kBAAkB,kBAAkB;AACpC;AACA;AACA;AACA;AACA;AACA,iBAAiB,sBAAsB;AACvC;AACA,qEAAqE,oBAAoB;AACzF;AACA;AACA;AACA,4EAA4E,GAAG,sBAAsB,IAAI,oDAAoD;AAC7J,YAAY;AACZ;AACA;AACA;AACA;AACA,+BAA+B;AAC/B,gCAAgC;AAChC,sCAAsC;AACtC;AACA,WAAW,sBAAsB;AACjC;AACA,+BAA+B,sBAAsB;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD,sBAAsB;AACtE,2CAA2C;AAC3C;AACA,yFAAyF,WAAW;AACpG;AACA;AACA;AACA;AACA;AACA,kBAAkB,uDAAuD;AACzE,2BAA2B,uBAAuB;AAClD;AACA;AACA;AACA,4BAA4B,uBAAuB;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kGAAkG;AAClG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,GAAG,aAAa,KAAK,cAAc;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB;AACvB;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA,wBAAwB;AACxB;AACA,sBAAsB;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,GAAG;AAChB;AACA;AACA;AACA;AACA;AACA,wBAAwB;AACxB,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,SAAS,eAAe;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA,gBAAgB,iBAAiB;AACjC;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA,OAAO,KAAK;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,aAAa;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6FAA6F,WAAW,WAAW;AACnH;AACA,iDAAiD,UAAU,WAAW;AACtE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,kCAAkC,kBAAkB;AACzE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,qBAAqB;AACtC;AACA;AACA,CAAC","sources":["webpack://cx-html2excel/external module {\"root\":\"ExcelJS\",\"commonjs\":\"exceljs\",\"commonjs2\":\"exceljs\",\"amd\":\"exceljs\",\"module\":\"exceljs\"}","webpack://cx-html2excel/webpack/bootstrap","webpack://cx-html2excel/webpack/runtime/define property getters","webpack://cx-html2excel/webpack/runtime/hasOwnProperty shorthand","webpack://cx-html2excel/webpack/runtime/make namespace object","webpack://cx-html2excel/./src/html2excel.js"],"sourcesContent":["var x = (y) => {\n\tvar x = {}; __webpack_require__.d(x, y); return x\n} \nvar y = (x) => (() => (x))\nmodule.exports = __WEBPACK_EXTERNAL_MODULE_exceljs__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const ExcelJS = require('exceljs');\r\n\r\nvar pdre1 = /^(\\d+):(\\d+)(:\\d+)?(\\.\\d+)?$/; // HH:MM[:SS[.UUU]]\r\nvar pdre2 = /^(\\d+)-(\\d+)-(\\d+)$/; // YYYY-mm-dd\r\nvar pdre3 = /^(\\d+)-(\\d+)-(\\d+)[T ](\\d+):(\\d+)(:\\d+)?(\\.\\d+)?$/; // YYYY-mm-dd(T or space)HH:MM[:SS[.UUU]], sans \"Z\"\r\n\r\nvar dnthresh  = Date.UTC(1899, 11, 30, 0, 0, 0); // -2209161600000\r\nvar dnthresh1 = Date.UTC(1899, 11, 31, 0, 0, 0); // -2209075200000\r\nvar dnthresh2 = Date.UTC(1904, 0, 1, 0, 0, 0); // -2209075200000\r\n\r\nvar FDRE1 = /^(0?\\d|1[0-2])(?:|:([0-5]?\\d)(?:|(\\.\\d+)(?:|:([0-5]?\\d))|:([0-5]?\\d)(|\\.\\d+)))\\s+([ap])m?$/;\r\nvar FDRE2 = /^([01]?\\d|2[0-3])(?:|:([0-5]?\\d)(?:|(\\.\\d+)(?:|:([0-5]?\\d))|:([0-5]?\\d)(|\\.\\d+)))$/;\r\nvar FDISO = /^(\\d+)-(\\d+)-(\\d+)[T ](\\d+):(\\d+)(:\\d+)(\\.\\d+)?[Z]?$/; // YYYY-mm-dd(T or space)HH:MM:SS[.UUU][Z]\r\n\r\nvar utc_append_works = new Date(\"6/9/69 00:00 UTC\").valueOf() == -17798400000;\r\n\r\nvar lower_months = ['january', 'february', 'march', 'april', 'may', 'june', 'july', 'august', 'september', 'october', 'november', 'december'];\r\n\r\nvar table_fmt = {\r\n\t0:  'General',\r\n\t1:  '0',\r\n\t2:  '0.00',\r\n\t3:  '#,##0',\r\n\t4:  '#,##0.00',\r\n\t9:  '0%',\r\n\t10: '0.00%',\r\n\t11: '0.00E+00',\r\n\t12: '# ?/?',\r\n\t13: '# ??/??',\r\n\t14: 'm/d/yy',\r\n\t15: 'd-mmm-yy',\r\n\t16: 'd-mmm',\r\n\t17: 'mmm-yy',\r\n\t18: 'h:mm AM/PM',\r\n\t19: 'h:mm:ss AM/PM',\r\n\t20: 'h:mm',\r\n\t21: 'h:mm:ss',\r\n\t22: 'm/d/yy h:mm',\r\n\t37: '#,##0 ;(#,##0)',\r\n\t38: '#,##0 ;[Red](#,##0)',\r\n\t39: '#,##0.00;(#,##0.00)',\r\n\t40: '#,##0.00;[Red](#,##0.00)',\r\n\t45: 'mm:ss',\r\n\t46: '[h]:mm:ss',\r\n\t47: 'mmss.0',\r\n\t48: '##0.0E+0',\r\n\t49: '@',\r\n\t56: '\"上午/下午 \"hh\"時\"mm\"分\"ss\"秒 \"'\r\n};\r\n\r\nconst fontFamilyDict = [\r\n\t'SimSun', 'SimHei', 'Microsoft YaHei', 'Microsoft JhengHei', 'NSimSun', 'PMingLiU', 'MingLiU', 'DFKai-SB', 'FangSong', 'KaiTi', 'FangSong_GB2312', 'KaiTi_GB2312',\r\n\t'STHeiti Light', 'STHeiti', 'STKaiti', 'STSong', 'STFangsong', 'LiHei Pro Medium', 'LiSong Pro Light', 'BiauKai', 'Apple LiGothic Medium', 'Apple LiSung Light',\r\n\t'LiSu', 'YouYuan', 'STXihei', 'STZhongsong', 'FZShuTi', 'FZYaoti', 'STCaiyun', 'STHupo', 'STLiti', 'STXingkai', 'STXinwei'\r\n]\r\n\r\nconst defaultOptions = {\r\n\trows: true,\r\n\tfont: true,\r\n\talignment: true,\r\n\tborder: true,\r\n\tnumfmt: true,\r\n\tchart: true\r\n}\r\n\r\nexport function generateExcel(tables, userOptions) {\r\n\tconst ops = { ...defaultOptions, ...userOptions };\r\n\tlet workbook = new ExcelJS.Workbook();\r\n\tfor (let table of tables) {\r\n\t\tlet xlsx = parse_dom_table(table.elet, ops);\r\n\t\tlet worksheet = workbook.addWorksheet(table.name);\r\n\t\tworksheet.columns = xlsx[\"!cols\"];\r\n\t\tif (ops.rows) {\r\n\t\t\tlet rows = xlsx[\"!rows\"];\r\n\t\t\tfor (let i = 0; i < rows.length; i++) {\r\n\t\t\t\tlet row = rows[i];\r\n\t\t\t\tworksheet.getRow(i + 1).height = row.hpx;\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet merges = xlsx[\"!merges\"];\r\n\t\tfor (let merge of merges) {\r\n\t\t\tworksheet.mergeCells(encode_range(merge));\r\n\t\t}\r\n\t\tlet data = xlsx[\"!data\"];\r\n\t\tfor (let key in data) {\r\n\t\t\tlet cell = worksheet.getCell(key);\r\n\t\t\tcell.value = data[key].v;\r\n\t\t\tif (ops.font) cell.font = data[key].s.font;\r\n\t\t\tif (ops.alignment) cell.alignment = data[key].s.alignment;\r\n\t\t\tif (ops.border) cell.border = data[key].s.border;\r\n\t\t\tif (ops.numfmt) cell.numFmt = data[key].z;\r\n\t\t\tif (ops.chart && data[key].chart) {\r\n\t\t\t\tconst imageId = workbook.addImage({\r\n\t\t\t\t\tbase64: data[key].chart.base64,\r\n\t\t\t\t\textension: 'png',\r\n\t\t\t\t});\r\n\t\t\t\tworksheet.addImage(imageId, {\r\n\t\t\t\t\ttl: {col: decode_cell(key).c, row: decode_cell(key).r},\r\n\t\t\t\t\text: { width: data[key].chart.width, height: data[key].chart.height }\r\n\t\t\t\t});\r\n\t\t\t\t// worksheet.addImage(imageId, data[key].chart.range);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn workbook.xlsx.writeBuffer().then(buffer => {\r\n    return buffer;\r\n  });\r\n}\r\n\r\nfunction sheet_add_dom(ws, table, _opts) {\r\n\tvar rows = table.rows;\r\n\tif(!rows) {\r\n\t\t/* not an HTML TABLE */\r\n\t\tthrow \"Unsupported origin when \" + table.tagName + \" is not a TABLE\";\r\n\t}\r\n\r\n\tvar opts = _opts || {};\r\n\tvar dense = ws[\"!data\"] != null;\r\n\tvar or_R = 0, or_C = 0;\r\n\tif(opts.origin != null) {\r\n\t\tif(typeof opts.origin == 'number') or_R = opts.origin;\r\n\t\telse {\r\n\t\t\tvar _origin = typeof opts.origin == \"string\" ? decode_cell(opts.origin) : opts.origin;\r\n\t\t\tor_R = _origin.r; or_C = _origin.c;\r\n\t\t}\r\n\t}\r\n\r\n\tvar sheetRows = Math.min(opts.sheetRows||10000000, rows.length);\r\n\tvar range = {s:{r:0,c:0},e:{r:or_R,c:or_C}};\r\n\tif(ws[\"!ref\"]) {\r\n\t\tvar _range = decode_range(ws[\"!ref\"]);\r\n\t\trange.s.r = Math.min(range.s.r, _range.s.r);\r\n\t\trange.s.c = Math.min(range.s.c, _range.s.c);\r\n\t\trange.e.r = Math.max(range.e.r, _range.e.r);\r\n\t\trange.e.c = Math.max(range.e.c, _range.e.c);\r\n\t\tif(or_R == -1) range.e.r = or_R = _range.e.r + 1;\r\n\t}\r\n\tvar merges = [], midx = 0;\r\n\tvar rowinfo = ws[\"!rows\"] || (ws[\"!rows\"] = []);\r\n\tvar _R = 0, R = 0, _C = 0, C = 0, RS = 0, CS = 0;\r\n\tif(!ws[\"!cols\"]) ws['!cols'] = [];\r\n\tlet colgroupElem = table.getElementsByTagName('colgroup')[0];\r\n\tlet colElems = colgroupElem.getElementsByTagName('col');\r\n\tfor (let i = 0; i < colElems.length; i++) {\r\n\t\tlet colElem = colElems[i];\r\n\t\tlet get_computed_style = get_get_computed_style_function(colElem);\r\n\t\tlet width = 0;\r\n\t\tif(get_computed_style) width = get_computed_style(colElem).getPropertyValue('width').match(/\\d+/g)[0];\r\n\t\tws['!cols'].push({key: String(i), width: (Number(width) / 5).toFixed(6)});\r\n\t}\r\n\tfor(; _R < rows.length && R < sheetRows; ++_R) {\r\n\t\tvar row = rows[_R];\r\n\t\tif (is_dom_element_hidden(row)) {\r\n\t\t\tif (opts.display) continue;\r\n\t\t\trowinfo[R] = {hidden: true};\r\n\t\t}\r\n\t\tif (rowinfo[R]) {\r\n\t\t\trowinfo[R].hpx = row.clientHeight;\r\n\t\t} else {\r\n\t\t\trowinfo[R] = {hpx: row.clientHeight};\r\n\t\t}\r\n\t\tlet trHeights = []\r\n\t\tfor (let tr of rows) {\r\n\t\t\ttrHeights.push({hpx: tr.clientHeight})\r\n\t\t}\r\n\t\tws[\"!rows\"] = trHeights\r\n\t\tvar elts = (row.cells);\r\n\t\tfor(_C = C = 0; _C < elts.length; ++_C) {\r\n\t\t\tvar elt = elts[_C];\r\n\t\t\tif (opts.display && is_dom_element_hidden(elt)) continue;\r\n\t\t\tvar v = elt.hasAttribute('data-v') ? elt.getAttribute('data-v') : elt.hasAttribute('v') ? elt.getAttribute('v') : htmldecode(elt.innerHTML);\r\n\t\t\tvar z = elt.getAttribute('data-z') || elt.getAttribute('z');\r\n\t\t\t// var numfmt = elt.getAttribute('data-numfmt') || elt.getAttribute('numfmt');\r\n\t\t\tfor(midx = 0; midx < merges.length; ++midx) {\r\n\t\t\t\tvar m = merges[midx];\r\n\t\t\t\tif(m.s.c == C + or_C && m.s.r < R + or_R && R + or_R <= m.e.r) { C = m.e.c+1 - or_C; midx = -1; }\r\n\t\t\t}\r\n\t\t\t/* TODO: figure out how to extract nonstandard mso- style */\r\n\t\t\tCS = +elt.getAttribute(\"colspan\") || 1;\r\n\t\t\tif( ((RS = (+elt.getAttribute(\"rowspan\") || 1)))>1 || CS>1) merges.push({s:{r:R + or_R,c:C + or_C},e:{r:R + or_R + (RS||1) - 1, c:C + or_C + (CS||1) - 1}});\r\n\t\t\tvar o = {t:'s', v:v};\r\n\t\t\tvar _t = elt.getAttribute(\"data-t\") || elt.getAttribute(\"t\") || \"\";\r\n\t\t\tif(v != null) {\r\n\t\t\t\tif(v.length == 0) o.t = _t || 'z';\r\n\t\t\t\telse if(opts.raw || v.trim().length == 0 || _t == \"s\"){}\r\n\t\t\t\telse if(v === 'TRUE') o = {t:'b', v:true};\r\n\t\t\t\telse if(v === 'FALSE') o = {t:'b', v:false};\r\n\t\t\t\telse if(!isNaN(fuzzynum(v))) o = {t:'n', v:fuzzynum(v)};\r\n\t\t\t\telse if(!isNaN(fuzzydate(v).getDate())) {\r\n\t\t\t\t\to = ({t:'d', v:parseDate(v)});\r\n\t\t\t\t\tif(opts.UTC) o.v = local_to_utc(o.v);\r\n\t\t\t\t\tif(!opts.cellDates) o = ({t:'n', v:datenum(o.v)});\r\n\t\t\t\t\t// o.z = opts.dateNF || table_fmt[14];\r\n\t\t\t\t\to.z = opts.dateNF || z || table_fmt[14];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(o.z === undefined && z != null) o.z = z;\r\n\t\t\t/* The first link is used.  Links are assumed to be fully specified.\r\n\t\t\t * TODO: The right way to process relative links is to make a new <a> */\r\n\t\t\tvar l = \"\", Aelts = elt.getElementsByTagName(\"A\");\r\n\t\t\tif(Aelts && Aelts.length) for(var Aelti = 0; Aelti < Aelts.length; ++Aelti)\tif(Aelts[Aelti].hasAttribute(\"href\")) {\r\n\t\t\t\tl = Aelts[Aelti].getAttribute(\"href\"); if(l.charAt(0) != \"#\") break;\r\n\t\t\t}\r\n\t\t\tif(l && l.charAt(0) != \"#\" &&\tl.slice(0, 11).toLowerCase() != 'javascript:') o.l = ({ Target: l });\r\n\t\t\to.s = setCellStyle(elt);\r\n\t\t\tif (parseChart(elt)) {\r\n\t\t\t\to.chart = parseChart(elt, C + or_C, R + or_R);\r\n\t\t\t}\r\n\t\t\t// o.s.numfmt = numfmt;\r\n\t\t\t// if(dense) { if(!ws[\"!data\"][R + or_R]) ws[\"!data\"][R + or_R] = []; ws[\"!data\"][R + or_R][C + or_C] = o; }\r\n\t\t\t// else ws[encode_cell({c:C + or_C, r:R + or_R})] = o;\r\n\t\t\tif (!ws[\"!data\"]) {\r\n\t\t\t\tws[\"!data\"] = {};\r\n\t\t\t}\r\n\t\t\tws[\"!data\"][encode_cell({c:C + or_C, r:R + or_R})] = o;\r\n\t\t\tif(range.e.c < C + or_C) range.e.c = C + or_C;\r\n\t\t\tC += CS;\r\n\t\t}\r\n\t\t++R;\r\n\t}\r\n\tif(merges.length) ws['!merges'] = (ws[\"!merges\"] || []).concat(merges);\r\n\trange.e.r = Math.max(range.e.r, R - 1 + or_R);\r\n\tws['!ref'] = encode_range(range);\r\n\tif(R >= sheetRows) ws['!fullref'] = encode_range((range.e.r = rows.length-_R+R-1 + or_R,range)); // We can count the real number of rows to parse but we don't to improve the performance\r\n\tconsole.log(ws)\r\n\treturn ws;\r\n}\r\n\r\nfunction parseChart(dom, cs, rs) {\r\n\tlet get_computed_style = get_get_computed_style_function(dom);\r\n\tlet rowSpan = dom.getAttribute(\"rowspan\") || 1;\r\n\tlet colSpan = dom.getAttribute(\"colspan\") || 1;\r\n\tlet re = rs + Number(rowSpan);\r\n\tlet ce = cs + Number(colSpan);\r\n\tlet range = encode_range({s:{c: cs, r: rs}, e:{c: ce, r: re}});\r\n\tlet imgEles = dom.getElementsByTagName('img');\r\n\tlet canvasEles = dom.getElementsByTagName('canvas');\r\n\tif (imgEles.length > 0) {\r\n\t\tlet imgEle = imgEles[0];\r\n\t\tlet width = 0, height = 0;\r\n\t\tif(get_computed_style) width = get_computed_style(imgEle).getPropertyValue('width').match(/\\d+/g)[0];\r\n\t\tif(get_computed_style) height = get_computed_style(imgEle).getPropertyValue('height').match(/\\d+/g)[0];\r\n\t\t// 创建 Canvas 元素\r\n\t\tconst canvas = document.createElement('canvas');\r\n\t\tcanvas.width = imgEle.width;\r\n\t\tcanvas.height = imgEle.height;\r\n\r\n\t\t// 将图像绘制到 Canvas 上\r\n\t\tconst ctx = canvas.getContext('2d');\r\n\t\tctx.drawImage(imgEle, 0, 0);\r\n\r\n\t\t// 获取 base64 编码的图像数据\r\n\t\tconst base64Image = canvas.toDataURL('image/png');\r\n\t\treturn {width: width, height: height, range: range, base64: base64Image};\r\n\t}\r\n\tif (canvasEles.length > 0) {\r\n\t\tlet canvasEle = canvasEles[0];\r\n\t\tlet width = 0, height = 0;\r\n\t\tif(get_computed_style) width = get_computed_style(canvasEle).getPropertyValue('width').match(/\\d+/g)[0];\r\n\t\tif(get_computed_style) height = get_computed_style(canvasEle).getPropertyValue('height').match(/\\d+/g)[0];\r\n\t\tconst base64Image = canvasEle.toDataURL('image/png');\r\n\t\treturn {width: width, height: height, range: range, base64: base64Image};\r\n\t}\r\n\treturn undefined;\r\n}\r\n\r\nfunction setCellStyle(dom) {\r\n\tlet get_computed_style = get_get_computed_style_function(dom);\r\n\tlet o = {};\r\n\tif (get_computed_style) {\r\n\t\tlet font = {};\r\n\t\tfont.size = get_computed_style(dom).getPropertyValue('font-size').match(/\\d+/g)[0];\r\n\t\tlet fontName = get_computed_style(dom).getPropertyValue('font-family');\r\n\t\tfont.name = fontFamilyDict.indexOf([fontName]) !== -1 ? fontName : 'SimSun';\r\n\t\tfont.bold = get_computed_style(dom).getPropertyValue('font-weight') === '700';\r\n\t\tlet fontStyleDict = {italic: 'italic', oblique: 'oblique'};\r\n\t\tfont.italic = fontStyleDict[get_computed_style(dom).getPropertyValue('font-style')] ? true : false;\r\n\t\tlet textDecoration = get_computed_style(dom).getPropertyValue('text-decoration');\r\n\t\tfont.underline = textDecoration === 'underline' ? true : false;\r\n\t\tfont.strike = textDecoration === 'line-through' ? true : false;\r\n\r\n\t\tlet hex = RGBToHex(get_computed_style(dom).getPropertyValue('color')).color;\r\n\t\tfont.color = { argb: 'ff' + hex };\r\n\t\to.font = font;\r\n\t\tlet alignment = {};\r\n\t\talignment.wrapText = get_computed_style(dom).getPropertyValue('white-space') !== 'nowrap';\r\n\t\t//部分css和excel属性值未匹配\r\n\t\tlet horizontalDict = {left: 'left', center: 'center', right: 'right', justify: 'justify'};\r\n\t\talignment.horizontal = horizontalDict[get_computed_style(dom).getPropertyValue('text-align')] || 'center';\r\n\t\tlet verticalDict = {top: 'top', middle: 'middle', bottom: 'bottom'};\r\n\t\talignment.vertical = verticalDict[get_computed_style(dom).getPropertyValue('vertical-align')] || 'middle';\r\n\t\to.alignment = alignment;\r\n\t\tlet border = {\r\n\t\t\ttop: parseBorder(get_computed_style(dom).getPropertyValue('border-top')),\r\n\t\t\tbottom: parseBorder(get_computed_style(dom).getPropertyValue('border-bottom')),\r\n\t\t\tleft: parseBorder(get_computed_style(dom).getPropertyValue('border-left')),\r\n\t\t\tright: parseBorder(get_computed_style(dom).getPropertyValue('border-right')),\r\n\t\t};\r\n\t\to.border = JSON.parse(JSON.stringify(border));\r\n\t}\r\n\treturn o;\r\n}\r\n\r\nfunction svg2base64(svgElement) {\r\n\tconst serializer = new XMLSerializer();\r\n\tconst svgXML = serializer.serializeToString(svgElement);\r\n\treturn btoa(svgXML);\r\n}\r\n\r\nfunction parse_dom_table(table, _opts) {\r\n\tvar opts = _opts || {};\r\n\tvar ws = ({}); if(opts.dense) ws[\"!data\"] = [];\r\n\treturn sheet_add_dom(ws, table, _opts);\r\n}\r\n\r\nfunction decode_range(range) {\r\n\tvar idx = range.indexOf(\":\");\r\n\tif(idx == -1) return { s: decode_cell(range), e: decode_cell(range) };\r\n\treturn { s: decode_cell(range.slice(0, idx)), e: decode_cell(range.slice(idx + 1)) };\r\n}\r\n\r\nfunction encode_range(cs,ce) {\r\n\tif(typeof ce === 'undefined' || typeof ce === 'number') {\r\nreturn encode_range(cs.s, cs.e);\r\n\t}\r\nif(typeof cs !== 'string') cs = encode_cell((cs));\r\n\tif(typeof ce !== 'string') ce = encode_cell((ce));\r\nreturn cs == ce ? cs : cs + \":\" + ce;\r\n}\r\n\r\nfunction parseBorder(s) {\r\n\tlet str = s.replace(new RegExp(', ', 'g'), ',')\r\n\tlet arr = str.split(' ');\r\n\tlet dict = {solid: 'thin', dotted: 'dotted', dashed: 'dashDot', double: 'double'};\r\n\tlet style = dict[arr[1]];\r\n\tif (!style) return undefined;\r\n\tlet color = RGBToHex(arr[2]);\r\n\treturn {style, color: {argb: 'ff' + color.color}};\r\n}\r\n\r\nfunction RGBToHex(rgba) {\r\n\tif (rgba.startsWith('rgba')) {\r\n\t\tlet str = rgba.slice(5, rgba.length - 1),\r\n\t\t\tarry = str.split(','),\r\n\t\t\topa = Number(arry[3].trim()) * 100,\r\n\t\t\tstrHex = \"\",\r\n\t\t\tr = Number(arry[0].trim()),\r\n\t\t\tg = Number(arry[1].trim()),\r\n\t\t\tb = Number(arry[2].trim());\r\n\r\n\t\tstrHex += ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);\r\n\r\n\t\treturn { color: strHex, opacity: opa };\r\n\t}\r\n\tlet str = rgba.slice(4, rgba.length - 1),\r\n\t\t\tarry = str.split(','),\r\n\t\t\tstrHex = \"\",\r\n\t\t\tr = Number(arry[0].trim()),\r\n\t\t\tg = Number(arry[1].trim()),\r\n\t\t\tb = Number(arry[2].trim());\r\n\r\n\tstrHex += ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);\r\n\r\n\treturn { color: strHex };\r\n}\r\n\r\nfunction decode_cell(cstr) {\r\n\tvar R = 0, C = 0;\r\n\tfor(var i = 0; i < cstr.length; ++i) {\r\n\t\tvar cc = cstr.charCodeAt(i);\r\n\t\tif(cc >= 48 && cc <= 57) R = 10 * R + (cc - 48);\r\n\t\telse if(cc >= 65 && cc <= 90) C = 26 * C + (cc - 64);\r\n\t}\r\n\treturn { c: C - 1, r:R - 1 };\r\n}\r\n\r\nfunction encode_cell(cell) {\r\n\tvar col = cell.c + 1;\r\n\tvar s=\"\";\r\n\tfor(; col; col=((col-1)/26)|0) s = String.fromCharCode(((col-1)%26) + 65) + s;\r\n\treturn s + (cell.r + 1);\r\n}\r\n\r\nfunction is_dom_element_hidden(element) {\r\n\tvar display = '';\r\n\tvar get_computed_style = get_get_computed_style_function(element);\r\n\tif(get_computed_style) display = get_computed_style(element).getPropertyValue('display');\r\n\tif(!display) display = element.style && element.style.display;\r\n\treturn display === 'none';\r\n}\r\n\r\nfunction datenum(v, date1904) {\r\n\tvar epoch = v.getTime();\r\n\tvar res = (epoch - dnthresh) / (24 * 60 * 60 * 1000);\r\n\tif(date1904) { res -= 1462; return res < -1402 ? res - 1 : res; }\r\n\treturn res < 60 ? res - 1 : res;\r\n}\r\n\r\nfunction get_get_computed_style_function(element) {\r\n\t// The proper getComputedStyle implementation is the one defined in the element window\r\n\tif(element.ownerDocument.defaultView && typeof element.ownerDocument.defaultView.getComputedStyle === 'function') return element.ownerDocument.defaultView.getComputedStyle;\r\n\t// If it is not available, try to get one from the global namespace\r\n\tif(typeof getComputedStyle === 'function') return getComputedStyle;\r\n\treturn null;\r\n}\r\n\r\nfunction local_to_utc(local) {\r\n\tconsole.log(new Date(Date.UTC(local.getFullYear(), local.getMonth(), local.getDate(), local.getHours(), local.getMinutes(), local.getSeconds(), local.getMilliseconds())))\r\n\treturn new Date(Date.UTC(local.getFullYear(), local.getMonth(), local.getDate(), local.getHours(), local.getMinutes(), local.getSeconds(), local.getMilliseconds()));\r\n}\r\n\r\nfunction parseDate(str, date1904) {\r\n\tif(str instanceof Date) return str;\r\n\tvar m = str.match(pdre1);\r\n\tif(m) return new Date((date1904 ? dnthresh2 : dnthresh1) + ((parseInt(m[1], 10)*60 + parseInt(m[2], 10))*60 + (m[3] ? parseInt(m[3].slice(1), 10) : 0))*1000 + (m[4] ? parseInt((m[4]+\"000\").slice(1,4), 10) : 0));\r\n\tm = str.match(pdre2);\r\n\tif(m) return new Date(Date.UTC(+m[1], +m[2]-1, +m[3], 0, 0, 0, 0));\r\n\t/* TODO: 1900-02-29T00:00:00.000 should return a flag to treat as a date code (affects xlml) */\r\n\tm = str.match(pdre3);\r\n\tif(m) return new Date(Date.UTC(+m[1], +m[2]-1, +m[3], +m[4], +m[5], ((m[6] && parseInt(m[6].slice(1), 10))|| 0), ((m[7] && parseInt(m[7].slice(1), 10))||0)));\r\n\tvar d = new Date(str);\r\n\treturn d;\r\n}\r\n\r\nfunction fuzzynum(s) {\r\n\tvar v = Number(s);\r\n\tif(!isNaN(v)) return isFinite(v) ? v : NaN;\r\n\tif(!/\\d/.test(s)) return v;\r\n\tvar wt = 1;\r\n\tvar ss = s.replace(/([\\d]),([\\d])/g,\"$1$2\").replace(/[$]/g,\"\").replace(/[%]/g, function() { wt *= 100; return \"\";});\r\n\tif(!isNaN(v = Number(ss))) return v / wt;\r\n\tss = ss.replace(/[(](.*)[)]/,function($$, $1) { wt = -wt; return $1;});\r\n\tif(!isNaN(v = Number(ss))) return v / wt;\r\n\treturn v;\r\n}\r\n\r\nfunction fuzzytime1(M)  {\r\n\tif(!M[2]) return new Date(Date.UTC(1899,11,31,(+M[1]%12) + (M[7] == \"p\" ? 12 : 0), 0, 0, 0));\r\n\tif(M[3]) {\r\n\t\t\tif(M[4]) return new Date(Date.UTC(1899,11,31,(+M[1]%12) + (M[7] == \"p\" ? 12 : 0), +M[2], +M[4], parseFloat(M[3])*1000));\r\n\t\t\telse return new Date(Date.UTC(1899,11,31,(M[7] == \"p\" ? 12 : 0), +M[1], +M[2], parseFloat(M[3])*1000));\r\n\t}\r\n\telse if(M[5]) return new Date(Date.UTC(1899,11,31, (+M[1]%12) + (M[7] == \"p\" ? 12 : 0), +M[2], +M[5], M[6] ? parseFloat(M[6]) * 1000 : 0));\r\n\telse return new Date(Date.UTC(1899,11,31,(+M[1]%12) + (M[7] == \"p\" ? 12 : 0), +M[2], 0, 0));\r\n}\r\nfunction fuzzytime2(M)  {\r\n\tif(!M[2]) return new Date(Date.UTC(1899,11,31,+M[1], 0, 0, 0));\r\n\tif(M[3]) {\r\n\t\t\tif(M[4]) return new Date(Date.UTC(1899,11,31,+M[1], +M[2], +M[4], parseFloat(M[3])*1000));\r\n\t\t\telse return new Date(Date.UTC(1899,11,31,0, +M[1], +M[2], parseFloat(M[3])*1000));\r\n\t}\r\n\telse if(M[5]) return new Date(Date.UTC(1899,11,31, +M[1], +M[2], +M[5], M[6] ? parseFloat(M[6]) * 1000 : 0));\r\n\telse return new Date(Date.UTC(1899,11,31,+M[1], +M[2], 0, 0));\r\n}\r\n\r\nfunction fuzzydate(s) {\r\n\t// See issue 2863 -- this is technically not supported in Excel but is otherwise useful\r\n\tif(FDISO.test(s)) return s.indexOf(\"Z\") == -1 ? local_to_utc(new Date(s)) : new Date(s);\r\n\tvar lower = s.toLowerCase();\r\n\tvar lnos = lower.replace(/\\s+/g, \" \").trim();\r\n\tvar M = lnos.match(FDRE1);\r\n\tif(M) return fuzzytime1(M);\r\n\tM = lnos.match(FDRE2);\r\n\tif(M) return fuzzytime2(M);\r\n\tM = lnos.match(pdre3);\r\n\tif(M) return new Date(Date.UTC(+M[1], +M[2]-1, +M[3], +M[4], +M[5], ((M[6] && parseInt(M[6].slice(1), 10))|| 0), ((M[7] && parseInt(M[7].slice(1), 10))||0)));\r\n\tvar o = new Date(utc_append_works && s.indexOf(\"UTC\") == -1 ? s + \" UTC\": s), n = new Date(NaN);\r\n\tvar y = o.getYear(), m = o.getMonth(), d = o.getDate();\r\n\tif(isNaN(d)) return n;\r\n\tif(lower.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)) {\r\n\t\tlower = lower.replace(/[^a-z]/g,\"\").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,\"\");\r\n\t\tif(lower.length > 3 && lower_months.indexOf(lower) == -1) return n;\r\n\t} else if(lower.replace(/[ap]m?/, \"\").match(/[a-z]/)) return n;\r\n\tif(y < 0 || y > 8099 || s.match(/[^-0-9:,\\/\\\\\\ ]/)) return n;\r\n\treturn o;\r\n}\r\n\r\nvar htmldecode = (function() {\r\n\tvar entities = [\r\n\t\t['nbsp', ' '], ['middot', '·'],\r\n\t\t['quot', '\"'], ['apos', \"'\"], ['gt',   '>'], ['lt',   '<'], ['amp',  '&']\r\n\t].map(function(x) { return [new RegExp('&' + x[0] + ';', \"ig\"), x[1]]; });\r\n\treturn function htmldecode(str) {\r\n\t\tvar o = str\r\n\t\t\t\t// Remove new lines and spaces from start of content\r\n\t\t\t\t.replace(/^[\\t\\n\\r ]+/, \"\")\r\n\t\t\t\t// Remove new lines and spaces from end of content\r\n\t\t\t\t.replace(/[\\t\\n\\r ]+$/,\"\")\r\n\t\t\t\t// Added line which removes any white space characters after and before html tags\r\n\t\t\t\t.replace(/>\\s+/g,\">\").replace(/\\s+</g,\"<\")\r\n\t\t\t\t// Replace remaining new lines and spaces with space\r\n\t\t\t\t.replace(/[\\t\\n\\r ]+/g, \" \")\r\n\t\t\t\t// Replace <br> tags with new lines\r\n\t\t\t\t.replace(/<\\s*[bB][rR]\\s*\\/?>/g,\"\\n\")\r\n\t\t\t\t// Strip HTML elements\r\n\t\t\t\t.replace(/<[^>]*>/g,\"\");\r\n\t\tfor(var i = 0; i < entities.length; ++i) o = o.replace(entities[i][0], entities[i][1]);\r\n\t\treturn o;\r\n\t};\r\n})();\r\n"],"names":[],"sourceRoot":""}